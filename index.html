<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Обработка VK токена</title>
</head>
<body style="font-family:Arial; text-align:center; padding:100px;">
  <h2>Авторизация...</h2>
  <p>Подожди 3 секунды, не закрывай страницу.</p>

  <script>
    const hash = window.location.hash.substring(1); // всё после #
    const params = new URLSearchParams(hash);
    const accessToken = params.get('access_token');
    const userId = params.get('user_id');

    if (!accessToken) {
      document.body.innerHTML = '<h2 style="color:red;">Ошибка: токен не найден</h2>';
    } else {
      // Отправляем токен на твой Google Apps Script
      fetch('https://script.google.com/macros/s/ТВОЙ_APPS_SCRIPT_ID/exec', {
        method: 'POST',
        mode: 'no-cors',  // важно для кросс-домена
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: accessToken, user_id: userId })
      }).then(() => {
        document.body.innerHTML = '<h1 style="color:green;">Готово!</h1><p>Данные записаны. Можешь закрыть вкладку.</p>';
      }).catch(err => {
        document.body.innerHTML = '<h2 style="color:red;">Ошибка отправки: ' + err + '</h2>';
      });
    }
  </script>
</body>
</html>